# Create KEYRING encrypted table, so it would generated percona-0 key, that we can rotate
CREATE TABLE t0 (a VARCHAR(255)) ENCRYPTION='KEYRING';

--error ER_SYSTEM_KEY_ROTATION_KEY_DOESNT_EXIST
ALTER INSTANCE ROTATE INNODB SYSTEM KEY 10;

--error ER_PARSE_ERROR
ALTER INSTANCE ROTATE INNODB SYSTEM KEY -1;

--error ER_PARSE_ERROR
ALTER INSTANCE ROTATE INNODB SYSTEM KEY K;

--error ER_PARSE_ERROR
ALTER INSTANCE ROTATE INNODB MASTER KEY 0;

--error ER_SYSTEM_KEY_ROTATION_KEY_DOESNT_EXIST
ALTER INSTANCE ROTATE INNODB SYSTEM KEY 4294967294;

--error ER_SYSTEM_KEY_ROTATION_MAX_KEY_ID_EXCEEDED
ALTER INSTANCE ROTATE INNODB SYSTEM KEY 4294967295;

ALTER INSTANCE ROTATE INNODB SYSTEM KEY 0;

CREATE TABLE t1 (a VARCHAR(255)) ENCRYPTION='KEYRING' ENCRYPTION_KEY_ID=1;

ALTER INSTANCE ROTATE INNODB SYSTEM KEY 1;

--error ER_SYSTEM_KEY_ROTATION_KEY_DOESNT_EXIST
ALTER INSTANCE ROTATE INNODB SYSTEM KEY 2;

CREATE TABLE t2 (a VARCHAR(255)) ENCRYPTION='KEYRING' ENCRYPTION_KEY_ID=2;

ALTER INSTANCE ROTATE INNODB SYSTEM KEY 2;

--error ER_SYSTEM_KEY_ROTATION_KEY_DOESNT_EXIST
ALTER INSTANCE ROTATE INNODB SYSTEM KEY 4294967294;

CREATE TABLE t4294967295 (a VARCHAR(255)) ENCRYPTION='KEYRING' ENCRYPTION_KEY_ID=4294967294;

ALTER INSTANCE ROTATE INNODB SYSTEM KEY 4294967294;

UNINSTALL PLUGIN keyring_file;

--echo # It should not be possible to rotate key percona_innodb without keyring_file installed
--echo # Key ids 0,1 and 4294967294 exist.

--error ER_SYSTEM_KEY_ROTATION_KEY_DOESNT_EXIST
ALTER INSTANCE ROTATE INNODB SYSTEM KEY 0;
--error ER_SYSTEM_KEY_ROTATION_KEY_DOESNT_EXIST
ALTER INSTANCE ROTATE INNODB SYSTEM KEY 1;
--error ER_SYSTEM_KEY_ROTATION_KEY_DOESNT_EXIST
ALTER INSTANCE ROTATE INNODB SYSTEM KEY 4294967294;

DROP TABLE t0,t1,t2,t4294967295;

# cleanup, restore keyring_file and keyring_file_data variable
--let $restart_parameters=restart:
--source include/restart_mysqld.inc
