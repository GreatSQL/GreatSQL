SET SESSION TRANSACTION ISOLATION LEVEL READ COMMITTED;
CREATE TABLE t1(
vc VARCHAR(64) primary key
) ENGINE=rocksdb COLLATE=latin1_bin;
INSERT INTO t1 VALUES('');
INSERT INTO t1 VALUES('     ');
ERROR 23000: Duplicate entry '     ' for key 't1.PRIMARY'
INSERT INTO t1 VALUES(0x0000);
INSERT INTO t1 VALUES(0x0000000000000000);
INSERT INTO t1 VALUES(0x000000000000000000);
INSERT INTO t1 VALUES('ABC');
SELECT hex(vc) from t1;
hex(vc)
000000000000000000
0000000000000000
0000

414243
BEGIN;
SELECT hex(vc) FROM t1 FOR UPDATE;
hex(vc)
000000000000000000
0000000000000000
0000

414243
SELECT SUBSTRING(a.key,9) FROM information_schema.rocksdb_locks AS a ORDER BY a.key;
SUBSTRING(a.key,9)
01000000000000000001002020202020202002
01000000000000000002
01000020202020202002
02
03414243202020202002
ROLLBACK;
drop table t1;
set session debug= '+d,MYROCKS_NO_LEAD_BYTE_VARCHAR_SPACE_PADDED';
CREATE TABLE t1(
vc VARCHAR(64) primary key
) ENGINE=rocksdb COLLATE=latin1_bin;
set session debug= '-d,MYROCKS_NO_LEAD_BYTE_VARCHAR_SPACE_PADDED';
INSERT INTO t1 VALUES('');
INSERT INTO t1 VALUES('     ');
ERROR 23000: Duplicate entry '     ' for key 't1.PRIMARY'
INSERT INTO t1 VALUES(0x0000);
INSERT INTO t1 VALUES(0x0000000000000000);
INSERT INTO t1 VALUES(0x000000000000000000);
INSERT INTO t1 VALUES('ABC');
SELECT hex(vc) from t1;
hex(vc)
000000000000000000
0000000000000000
0000

414243
BEGIN;
SELECT hex(vc) FROM t1 FOR UPDATE;
hex(vc)
000000000000000000
0000000000000000
0000

414243
SELECT SUBSTRING(a.key,9) FROM information_schema.rocksdb_locks AS a ORDER BY a.key;
SUBSTRING(a.key,9)
000000000000000001002020202020202002
000000000000000002
000020202020202002
202020202020202002
414243202020202002
ROLLBACK;
drop table t1;
CREATE TABLE t1(
a int,
vc VARCHAR(64),
PRIMARY KEY (a, vc)
) ENGINE=rocksdb COLLATE=latin1_bin;
INSERT INTO t1 VALUES(1, '');
INSERT INTO t1 VALUES(2, '  ');
INSERT INTO t1 VALUES(3, '        ');
INSERT INTO t1 VALUES(4, '          ');
INSERT INTO t1 VALUES(5, 'abc');
INSERT INTO t1 VALUES(6, 'abc     ');
INSERT INTO t1 VALUES(7, 'abc       ');
SELECT hex(vc) from t1;
hex(vc)

2020
2020202020202020
20202020202020202020
616263
6162632020202020
61626320202020202020
BEGIN;
SELECT hex(vc) FROM t1 FOR UPDATE;
hex(vc)

2020
2020202020202020
20202020202020202020
616263
6162632020202020
61626320202020202020
SELECT SUBSTRING(a.key,9) FROM information_schema.rocksdb_locks AS a ORDER BY a.key;
SUBSTRING(a.key,9)
8000000102
8000000202
8000000302
8000000402
8000000503616263202020202002
8000000603616263202020202002
8000000703616263202020202002
ROLLBACK;
drop table t1;
set session debug= '+d,MYROCKS_NO_LEAD_BYTE_VARCHAR_SPACE_PADDED';
CREATE TABLE t1(
a int,
vc VARCHAR(64),
PRIMARY KEY (a, vc)
) ENGINE=rocksdb COLLATE=latin1_bin;
set session debug= '-d,MYROCKS_NO_LEAD_BYTE_VARCHAR_SPACE_PADDED';
INSERT INTO t1 VALUES(1, '');
INSERT INTO t1 VALUES(2, '  ');
INSERT INTO t1 VALUES(3, '        ');
INSERT INTO t1 VALUES(4, '          ');
INSERT INTO t1 VALUES(5, 'abc');
INSERT INTO t1 VALUES(6, 'abc     ');
INSERT INTO t1 VALUES(7, 'abc       ');
SELECT hex(vc) from t1;
hex(vc)

2020
2020202020202020
20202020202020202020
616263
6162632020202020
61626320202020202020
BEGIN;
SELECT hex(vc) FROM t1 FOR UPDATE;
hex(vc)

2020
2020202020202020
20202020202020202020
616263
6162632020202020
61626320202020202020
SELECT SUBSTRING(a.key,9) FROM information_schema.rocksdb_locks AS a ORDER BY a.key;
SUBSTRING(a.key,9)
80000001202020202020202002
80000002202020202020202002
80000003202020202020202002
80000004202020202020202002
80000005616263202020202002
80000006616263202020202002
80000007616263202020202002
ROLLBACK;
drop table t1;
CREATE TABLE t1(
a int,
vc VARCHAR(64),
KEY (vc)
) ENGINE=rocksdb COLLATE=latin1_bin;
INSERT INTO t1 VALUES(1, '');
INSERT INTO t1 VALUES(2, '  ');
INSERT INTO t1 VALUES(5, 'abc');
INSERT INTO t1 VALUES(6, 'abc     ');
INSERT INTO t1 VALUES(7, 'abc       ');
INSERT INTO t1 VALUES(3, '        ');
INSERT INTO t1 VALUES(4, '          ');
SELECT hex(vc) from t1 order by vc;
hex(vc)

2020
2020202020202020
20202020202020202020
616263
6162632020202020
61626320202020202020
drop table t1;
set session debug= '+d,MYROCKS_NO_LEAD_BYTE_VARCHAR_SPACE_PADDED';
CREATE TABLE t1(
a int,
vc VARCHAR(64),
KEY (vc)
) ENGINE=rocksdb COLLATE=latin1_bin;
set session debug= '-d,MYROCKS_NO_LEAD_BYTE_VARCHAR_SPACE_PADDED';
INSERT INTO t1 VALUES(1, '');
INSERT INTO t1 VALUES(2, '  ');
INSERT INTO t1 VALUES(5, 'abc');
INSERT INTO t1 VALUES(6, 'abc     ');
INSERT INTO t1 VALUES(7, 'abc       ');
INSERT INTO t1 VALUES(3, '        ');
INSERT INTO t1 VALUES(4, '          ');
SELECT hex(vc) from t1 order by vc;
hex(vc)

2020
2020202020202020
20202020202020202020
616263
6162632020202020
61626320202020202020
drop table t1;
CREATE TABLE t1(
vc VARCHAR(64) primary key
) ENGINE=rocksdb COLLATE=utf8mb4_bin;
INSERT INTO t1 VALUES('');
INSERT INTO t1 VALUES('     ');
ERROR 23000: Duplicate entry '     ' for key 't1.PRIMARY'
INSERT INTO t1 VALUES(0x0000);
INSERT INTO t1 VALUES(0x0000000000000000);
INSERT INTO t1 VALUES(0x000000000000000000);
INSERT INTO t1 VALUES('ABC');
SELECT hex(vc) from t1;
hex(vc)
000000000000000000
0000000000000000
0000

414243
BEGIN;
SELECT hex(vc) FROM t1 FOR UPDATE;
hex(vc)
000000000000000000
0000000000000000
0000

414243
SELECT SUBSTRING(a.key,9) FROM information_schema.rocksdb_locks AS a ORDER BY a.key;
SUBSTRING(a.key,9)
01000000000000000000010000000000000000000100000000000000000002
01000000000000000000010000000000000000000100000000000000002002
0100000000000000002002
02
0300004100004200004302
ROLLBACK;
drop table t1;
set session debug= '+d,MYROCKS_NO_LEAD_BYTE_VARCHAR_SPACE_PADDED';
CREATE TABLE t1(
vc VARCHAR(64) primary key
) ENGINE=rocksdb COLLATE=utf8mb4_bin;
set session debug= '-d,MYROCKS_NO_LEAD_BYTE_VARCHAR_SPACE_PADDED';
INSERT INTO t1 VALUES('');
INSERT INTO t1 VALUES('     ');
ERROR 23000: Duplicate entry '     ' for key 't1.PRIMARY'
INSERT INTO t1 VALUES(0x0000);
INSERT INTO t1 VALUES(0x0000000000000000);
INSERT INTO t1 VALUES(0x000000000000000000);
INSERT INTO t1 VALUES('ABC');
SELECT hex(vc) from t1;
hex(vc)
000000000000000000
0000000000000000
0000

414243
BEGIN;
SELECT hex(vc) FROM t1 FOR UPDATE;
hex(vc)
000000000000000000
0000000000000000
0000

414243
SELECT SUBSTRING(a.key,9) FROM information_schema.rocksdb_locks AS a ORDER BY a.key;
SUBSTRING(a.key,9)
000000000000000000010000000000000000000100000000000000000002
000000000000000000010000000000000000000100000000000000002002
00000000000000002002
00002000002000002002
00004100004200004302
ROLLBACK;
drop table t1;
